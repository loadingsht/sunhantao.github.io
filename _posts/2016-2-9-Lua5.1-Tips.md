---
layout: post
comments: true
categories: lua
---
## Lua5.1 Tips
  摘自《Lua程序设计（第二版）》中的一些例子、技巧。
  
  虽然Lua5.3已经发布了，但由于cocos-lua因为tolua++和luajit的版本限制，还是使用Lua5.1，所以主要按Lua5.1学习。
  
  代码在Lua5.3的编译器上运行，选取兼容方案，或记录版本差异，为将来可能发生的版本升级备案。
  
### 变量

- lua允许下划线开头命名的变量，但由于下画线＋大写字母的变量lua作为系统保留变量，而且单独的下划线用作哑变量（函数多返回值中不关心的部分），所以我个人不认为工程中不要用下划线开头的变量。
- 释放一个变量就是将nil赋值给它，然后GC可以自动释放它。
- 字符串可以用单引号或双引号括起来，风格需统一，建议单引号，可以编辑更快。
- bool变量只有false和nil表示假，其余都是真。
- 字符串不以'\0'表示结尾，但占一个字节：


```lua
print (#'good\0bye') -- 8
print ('good\0bye') -- goodbye
```


### 表达式

- '#'表达式，表示数组或字符串的长度。它可以用来方便的对数组操作：


```lua
print(a[#a]) -- 打印数组最后一个值
a[#a] = nil  -- 删除最后一个值
a[#a+1] = v  -- 在数组后面添加一个值，可用来循环给数组赋值
```


- and or 逻辑操作符，并不是返回bool值，而是根据两端的真假返回两端本身的值。比如：


```lua
a = false or 1 -- 返回1
b = 3 and 2 -- 返回2
c = nil and 15 -- 返回nil
```


- '%'取余表达式规则： a % b = a - floor(a/b)*b。
  - 结果符号和被余数相同，可以对负数取余，可以对小数取余。
  - 可以这么想，对负数取余＝与比自己大的最小余数整数倍差值。对正数取余＝与比自己小的最大余数整数倍差值
  - 小数常用在取被余数的精度或精度之外的部分


```lua
print(-7 % -4) -- -3
print(-7 % 4)  -- 1
print(7 % -4)  -- -1
print(7 % 4)   -- 3
print(7 % 4)   -- 3
print(7.12 % 0.1)   -- 0.02
print(-7.12 % 0.1)   -- 0.08 要注意，这可能不是你的本意
print(7.12 - 7.12 % 1)   -- 7 取整
```


### table

- 数组的开始下标默认是1。
- table作为数组，取得长度用"#"，不要用其他api诸如getn等，在lua5.1-5.3这些api都有变化。
- table作为数组，下标要连续，不能出现中间值为nil的情况，否则如何遍历都找不到后面的值了。如果一定要用离散值，需要一个辅助table。

